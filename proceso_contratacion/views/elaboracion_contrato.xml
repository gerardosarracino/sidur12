<odoo>
  <data>
    <!-- CONTRATO TREE-->
    <record model="ir.ui.view" id="proc_contratacion_elaboracion_contratos_tree">
      <field name="name">proceso.elaboracion_contrato.tree</field>
      <field name="model">proceso.elaboracion_contrato</field>
      <field name="arch" type="xml">
        <tree>
          <field name="fecha"/>
          <field name="contrato" string="# Contrato"/>
          <field name="name" string="Objeto"/>
          <field name="contratista"/>
          <field name="impcontra"/>
        </tree>
      </field>
    </record>

    <!-- ELABORACION DE CONTRATO SEARCH-->
      <record model="ir.ui.view" id="proceso_contrato_search">
         <field name="name">elaboracion contrato</field>
         <field name="model">proceso.elaboracion_contrato</field>
         <field name="arch" type="xml">
            <search>
                  <field name="fecha"/>
                  <field name="contrato" string="# Contrato"/>
                  <field name="obra"  string="Objeto Licitaciones"/>
                  <field name="adjudicacion"  string="/ Adjudicaciones Directas"/>
                  <field name="contratista"/>
                  <field name="impcontra"/>
            </search>
         </field>
        </record>

      <!-- FORMULARIO AL DAR CLICK M2M PARTIDAS -->
      <record id="partidas_form" model="ir.ui.view">
          <field name="name">partidas form</field>
          <field name="model">partidas.partidas</field>
          <field name="priority">17</field>
          <field name="context">17</field>
          <field name="arch" type="xml">
            <form create="false" delete="false" edit="false">
                <sheet>
                    <group colspan="2" col="4" class="oe_read_only" string="Partida">
                        <field name="id" invisible="1"/>
                        <field name="obra"/>
                        <field name="programaInversion"/>
                        <field name="monto_partida" sum="Monto" widget="monetary" />
                        <field name="iva_partida" readonly="True" sum="I.V.A" widget="monetary"/>
                        <field name="total_partida" readonly="True" sum="Total" widget="monetary"/>
                        <field name="numero_contrato" invisible="1"/>
                        <field name="nombre_partida" invisible="1"/>
                        <field name="nueva_partida" invisible="1"/>
                    </group>

                    <group string="Anticipo" >
                        <field name="numero_contrato" />
                        <field name="contratista"/>
                        <field name="anticipada" invisible="1"/>
                    </group>
                    <group>
                        <field name="fecha_anticipos" required="True" class="oe_inline" attrs="{'readonly':[('anticipada', '=' , True)]}"/>
                    </group>

                    <group colspan="1" col="4">
                        <field name="porcentaje_anticipo" required="True" class="oe_inline" attrs="{'readonly':[('anticipada', '=' , True)]}"/>
                        <field name="total_anticipo_porcentaje"/>
                        <field name="anticipo_material" class="oe_inline" attrs="{'readonly':[('anticipada', '=' , True)]}" required="True"/>
                        <field name="total_partida" readonly="1" string="Importe Contratado"/>
                    </group>

                    <group>
                        <field name="anticipo_a"/>
                        <field name="iva_anticipo"/>
                        <field name="total_anticipo"/>
                    </group>

                    <group colspan="1" col="4">
                        <field name="numero_fianza" class="oe_inline" attrs="{'readonly':[('anticipada', '=' , True)]}" required="True"
                        widget="integer"/>
                        <field name="afianzadora" attrs="{'readonly':[('anticipada', '=' , True)]}" required="True"/>
                        <field name="fecha_fianza" attrs="{'readonly':[('anticipada', '=' , True)]}" required="True"/>
                    </group>
                </sheet>
            </form>
          </field>
      </record>

            <!-- ACCIONES VENTANA DE ANTICIPO -->
    <record model="ir.actions.act_window" id="anticipo_boton">
      <field name="name">Anticipo</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">partidas.partidas</field>
      <field name="view_mode">form</field>
      <field name="target">current</field>
        <field name="view_ids" eval="[(5, 0, 0),
    (0, 0, {'view_mode': 'form', 'view_id': ref('partidas_form')})]"/>
    </record>

    <!-- ELABORACION DE CONTRATO FORM-->
    <record model="ir.ui.view" id="proc_contratacion_elaboracion_contrato_form">
      <field name="name">proceso.elaboracion_contrato.form</field>
      <field name="model">proceso.elaboracion_contrato</field>
      <field name="arch" type="xml">
        <form>
          <sheet>
              <div class="oe_button_box oe_read_only" name="button_box">

                   <button string="Fin. Contrato Anticipadamente" type="object" name="finiquitarContrato1" class="oe_highlight" context="{
                       'search_default_contrato': active_id,
                       'default_contrato': active_id
                       }" attrs="{'invisible': [('contar_finiquito', '=', 1)]}" icon="fa-clock-o"/>
                    <button string="Fin. Contrato Anticipadamente" type="object" name="finiquitarContrato2" class="oe_highlight" context="{
                       'search_default_contrato': active_id,
                       'default_contrato': active_id
                       }" attrs="{'invisible': [('contar_finiquito', '=', 0)]}" icon="fa-clock-o"/>
                </div>

            <notebook >
                    <page string="Datos Generales" icon="fa-bitbucket">

                             <group string="Contrato Datos Generales"  >

                                <field name="obra" string="Seleccionar Licitacion"  attrs="{'invisible':
                                [('adjudicacion', '!=', False)]}" />



                                 <field name="adjudicacion" attrs="{'invisible': [('obra', '!=', False)]}"
                                       domain="[('contratado','=',True)]" /> <!-- domain="[('contratado','=','True')]" -->
                                </group>

                                  <group colspan="1" col="4">
                                    <field name="fecha" class="oe_inline"/>

                                    <field name="contrato" />
                                    <field name="obra_partida" invisible="1"/>
                                      <!-- importe contrato auxiliar -->
                                    <field name="impcontra" invisible="1" force_save="1"/>
                                  </group>

                            <group colspan="2" col="1">
                                 <field name="contrato_partida_adjudicacion" context="{'form_view_ref': 'proceso_contratacion.partidas_form'}"
                                 attrs="{'invisible': [('adjudicacion', '=', False)]}"
                                        string="" nolabel="1">
                                    <tree create="false" editable="bottom" delete="false" decoration-warning="fecha_anticipos==True">
                                        <field name="obra" readonly="1" force_save="1"/>
                                        <field name="programaInversion" readonly="1" force_save="1"/>
                                        <field name="monto_partida" sum="Monto" widget="monetary" />
                                        <field name="iva_partida" readonly="True" sum="I.V.A" widget="monetary"/>
                                        <field name="total_partida" readonly="True" sum="Total" widget="monetary"/>
                                        <field name="numero_contrato" invisible="1"/>
                                        <field name="nombre_partida" invisible="1"/>
                                        <field name="nueva_partida" invisible="1"/>
                                        <field name="fecha_anticipos" invisible="1"/>

                                        <button name="anticipo" type="object" string="Anticipo" class="btn btn-primary"
                                        />

                                        <!-- id de la partida -->
                                        <field name="p_id" invisible="1"/>
                                </tree>
                            </field>

                                 <field name="contrato_partida_licitacion" context="{'form_view_ref': 'proceso_contratacion.partidas_form'}"
                                 attrs="{'invisible': [('obra', '=', False)]}" string="" nolabel="1">
                                    <tree editable="bottom" create="false" delete="false" >
                                        <field name="obra" readonly="1"/>
                                        <field name="programaInversion" readonly="1"/>
                                        <field name="monto_partida" sum="Monto" widget="monetary"/>
                                        <field name="iva_partida" readonly="True" sum="I.V.A" widget="monetary"/>
                                        <field name="total_partida" readonly="True" sum="Total" widget="monetary"/>
                                        <field name="numero_contrato" invisible="1"/>
                                        <field name="nombre_partida" invisible="1"/>
                                        <field name="nueva_partida" invisible="1"/>
                                        <field name="nueva_partida" invisible="1"/>

                                        <button name="anticipo" type="object" string="Anticipo" />
                                </tree>
                                </field>
                            </group>
                                     <!-- CONTADORES -->
                                     <field name="contar_finiquito"  invisible="1"/>
                                     <field name="contar_convenio"  invisible="1"/>

                            <group colspan="1" col="4">
                                <field name="name"/>
                                <field name="unidadresponsableejecucion" class="oe_inline"/>
                                <field name="descripciontrabajos"/>
                            </group>
                            <group colspan="1" col="4">
                                <field name="supervisionexterna" />
                                <field name="supervisionexterna1" />
                            </group>


                        <group>
                            <field name="contratista"/>
                        </group>

                        <group colspan="1" col="2">
                            <group><field name="fechainicio" class="oe_inline"/></group>
                            <group><field name="fechatermino" class="oe_inline"/></group>
                            <group><field name="periodicidadretencion" class="oe_inline"/></group>
                            <group><field name="retencion" class="oe_inline"/></group>
                        </group>

                    </page>


                    <!-- FIANZAS -->
                    <page string="Fianzas"  >
                        <separator string="Fianzas"/>
                        <field name="fianzas" widget="one2many" string="">
                            <tree editable="bottom">
                                <control>
                                     <create string="Agregar Fianza"/>
                                </control>
                                <field name="tipo_fianza"/>
                                <field name="numero_fianza_fianzas"/>
                                <field name="monto"/>
                                <field name="fecha_fianza_fianzas"/>
                                <field name="afianzadora_fianzas"/>
                            </tree>
                        </field>
                    </page>

                    <!-- DEDUCCIONES -->
                     <page string="Deducciones" >
                        <group string="Deducciones">
                        </group>
                         <field name="deducciones" string="" options="{'no_create': True, 'no_create_edit':True, 'not_delete': True}">
                             <tree >
                                 <control>
                                     <create string="Agregar Deducción"/>
                                 </control>
                                 <field name="name" />
                                 <field name="porcentaje" />
                             </tree>
                         </field>
                    </page>
                    <!-- LISTA DE RECURSOS -->
                    <page string="Lista De Recursos" >
                        <separator string="Lista De Recursos" />
                        <field name="anexos" readonly="1" string="" force_save="1">
                            <tree force_save="1">
                                <field name="name" force_save="1" invisible="1"/>
                                <field name="claveobra" force_save="1"/>
                                <field name="clave_presupuestal" force_save="1"/>
                                <field name="federal" force_save="1"/>
                                <field name="concepto" force_save="1" invisible="1"/>
                                <field name="estatal" force_save="1"/>
                                <field name="municipal" force_save="1"/>
                                <field name="otros" force_save="1" />
                                <field name="federalin" force_save="1" invisible="1"/>
                                <field name="estatalin" force_save="1" invisible="1"/>
                                <field name="municipalin" force_save="1" invisible="1"/>
                                <field name="otrosin" force_save="1" invisible="1"/>
                                <field name="total" force_save="1" invisible="1"/>
                                <field name="cancelados" force_save="1" invisible="1"/>
                                <field name="total_ca" force_save="1"/>
                                <field name="totalin" force_save="1"/>
                                <field name="total1" force_save="1"/>
                                <field name="total_at" force_save="1" invisible="1"/>
                            </tree>
                        </field>
                        <hr/>
                        <field name="enlace_oficio" invisible="1"/>
                        <group>
                            <field name="recurso_autorizado"/>
                            <field name="importe_cancelado"/>
                            <field name="total_recurso_aut"/>
                        </group>
                        <hr/>
                        <group>
                            <field name="impcontra" readonly="1" force_save="1"/>
                            <field name="convenios_escalatorias"/>
                            <field name="total_contratado"/>
                        </group>

                        <group colspan="1" col="2">
                            <group>
                                <field name="saldo"/>
                            </group>
                            <group>
                                <p style="color: #589F14" attrs="{'invisible':[('saldo', '&lt;' , 0)]}">RECURSOS SUFICIENTES. *</p>
                                <p style="color: #DE0C0C" attrs="{'invisible':[('saldo', '&gt;' , 1)]}">RECURSOS INSUFICIENTES. *</p>
                            </group>
                        </group>
                    </page>

            </notebook>
          </sheet>
        </form>
      </field>
    </record>

    <!-- ACCIONES VENTANA ELABORACION DE CONTRATO-->
    <record model="ir.actions.act_window" id="proc_contratacion_elaboracion_contrato_action_window">
      <field name="name">Contratos</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">proceso.elaboracion_contrato</field>
      <field name="view_mode">tree,form</field>
    </record>




    <!-- FORMULARIOS Y TREE DE LAS PARTIDAS CON SUS CATALOGOS -->
      <record id="conceptos_contratados_partidas_form" model="ir.ui.view">
          <field name="name">conceptos contratados form</field>
          <field name="model">partidas.partidas</field>
          <field name="arch" type="xml">
              <form string="">
                  <sheet>
                      <group string="Nombre de la Obra:">
                            <field name="obra" nolabel="1" readonly="1"/>
                        </group>
                            <hr/>
                        <group colspan="2" col="5" context="{'default_ejercicio': obra.id}">
                            <separator string="Programa"/>
                            <separator string="Ejercicio" />
                            <separator string="Monto/Iva"/>
                            <separator string="Municipio"/>
                            <separator string="Localidad"/>
                        </group>
                        <group colspan="2" col="6">
                            <field name="programaInversion" string="" nolabel="1" readonly="1"/>
                            <field name="ejercicio" string="" nolabel="1"/>
                            <field name="total_partida" widget="monetary" string="" nolabel="1"/>
                            <field name="municipio" string="" nolabel="1"/>
                            <field name="localidad" string="" nolabel="1"/>
                        </group>
                          <hr/>
                        <group colspan="2" col="5">
                           <separator string="Fecha del Anticipo"/>
                           <separator string="Fecha del contrato"/>
                           <separator string="Fecha de Inicio Contractual"/>
                           <separator string="Fecha de Termino Contractual"/>
                           <separator string="Supervision Externa"/>
                        </group>
                        <group colspan="2" col="6">
                          <field name="fecha_anticipos" readonly="1" string="" nolabel="1"/>
                          <field name="fecha" string="" nolabel="1"/>
                          <field name="fechainicio" string="" nolabel="1"/>
                          <field name="fechatermino" string="" nolabel="1"/>
                          <field name="supervisionexterna1" string="" nolabel="1"/>
                        </group>
                     <hr/>
                      <group>
                        <group colspan="2" col="2">
                            <group string="Catálogo de Niveles/Conceptos del Contrato:"></group>
                            <group><field name="name" string="" class="o_light_label"/></group>
                        </group>
                        <group colspan="2" col="3">
                            <group><field name="total_partida" /></group>
                            <group> <field name="total_catalogo"/></group>
                            <group><field name="diferencia"  class="o_light_label"/></group>
                        </group>
                        <field name="conceptos_partidas" widget="section_and_note_one2many" string="# Concepto de partidas">
                            <tree editable="bottom">
                                <control>
                                    <create string="Agregar Sección" context="{'default_display_type': 'line_section'}"/>
                                    <create string="Agregar Nivel"/>
                                </control>
                                <field name="name" widget="section_and_note_Text" string="Sección"/>
                                <field name="sequence" type="handle" invisible="1"/>
                                <field name="display_type" invisible="1" />
                                <field name="categoria" string="Clave"/>
                                <field name="grupo"/>
                                <field name="concepto"/>
                                <field name="medida"/>
                                <field name="cantidad"/>
                                <field name="precio_unitario" widget="monetary"/>
                                <field name="importe" sum="importe" widget="monetary"/>
                            </tree>
                        </field>
                          <group class="oe_subtotal_footer">
                                        <h6 style="position:relative;
                                                      display: inline-block;
                                                         left: -75px;
                                                          top: -50px;
                                                  white-space: nowrap;"> TOTAL:  </h6>
                                </group>
                    </group>
                  </sheet>
              </form>
          </field>
      </record>
    <!-- TREE CATALOGOS -->
     <record model="ir.ui.view" id="proc_contratacion_elaboracion_contrato_3">
      <field name="name">proceso.elaboracion_contrato.tree3</field>
      <field name="model">partidas.partidas</field>
      <field name="arch" type="xml">
        <tree create="false">
            <field name="fecha" string="Fecha"/>
            <field name="numero_contrato" string="# Contrato"/>
            <field name="objeto" string="Objeto"/>
            <field name="contratista" string="Contratista" />
            <field name="monto_partida" string="Importe Contrato"/>
            <field name="a_fis" />
            <field name="a_fin" />
            <field name="total" string="Importe Catalogo"/> <!-- total_contrato error singleton -->
        </tree>
      </field>
    </record>



    <!-- ACCIONES PARA ELIMINAR EL BOTON DELETE DE CONCEPTOS DE CONTRATO -->
    <record id="partner_tree_no_delete_concepto" model="ir.ui.view">
        <field name="name">contrato.tree.no.delete.concepto</field>
        <field name="model">partidas.partidas</field>
        <field name="inherit_id" ref="proc_contratacion_elaboracion_contrato_3" />
        <field name="arch" type="xml">
            <xpath expr="//tree" position="attributes">
                <attribute name="delete">false</attribute>
            </xpath>
        </field>
    </record>

  <!-- ACCIONES VENTANA CONCEPTOS CONTRATADOS -->
    <record model="ir.actions.act_window" id="proc_contratacion_concepto_contratados_action_window">
      <field name="name">Conceptos de Contratados</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">partidas.partidas</field>
      <field name="view_ids" eval="[(5, 0, 0),
    (0, 0, {'view_mode': 'tree', 'view_id': ref('proc_contratacion_elaboracion_contrato_3')}),
    (0, 0, {'view_mode': 'form', 'view_id': ref('conceptos_contratados_partidas_form')})]"/>
      <field name="view_mode">form</field>
    </record>

    <!-- MENUS ELABORACION DE CONTRATO -->
      <menuitem name="Elaboración de contratos" id="proc_contratacion_elaboracion_contrato"
                parent="proc_contratacion_menu_root" action="proc_contratacion_elaboracion_contrato_action_window" sequence="4"/>


    <!-- MENUS CONCEPTOS CONTRATADOS-->
      <menuitem name="Conceptos Contratados" id="proc_contratacion_conceptos_contratados"
                parent="proc_contratacion_menu_root" action="proc_contratacion_concepto_contratados_action_window" sequence="6"/>

</data>
</odoo>