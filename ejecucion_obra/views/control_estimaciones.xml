<odoo>
  <data>


    <!-- ESTIMACIONES FORM -->
  <record id="control_estimaciones_estimaciones_form" model="ir.ui.view">
        <field name="name">control de estimaciones form</field>
        <field name="model">control.estimaciones</field>
        <field name="arch" type="xml">
            <form string="">
                <sheet>
                    <notebook>
                        <page string="Datos Generales De La Estimación">
                            <group string="Datos Generales De La Estimación" colspan="1" col="2">
                        <group>
                            <field name="obra"/>
                            <field name="tipo_estimacion" widget="radio"/>
                        </group>
                        <group>
                            <field name="numero_estimacion" attrs="{'readonly': [('tipo_estimacion','!=', '2')]}"/>
                        </group>
                    </group>
                    <group  colspan="2" col="2">
                        <group string="Periodo de la Estimación">
                            <field name="fecha_inicio_estimacion" class="oe_inline"/>
                            <field name="fecha_termino_estimacion" class="oe_inline"/>
                        </group>
                        <group string="Seguimiento">
                            <field name="fecha_presentacion" class="oe_inline"/>
                            <field name="fecha_revision" class="oe_inline"/>
                        </group>
                        <group string="Indique si Aplica">
                            <field name="si_aplica" widget="radio"/>
                        </group>
                        <group string="Notas:">
                            <field name="notas"/>
                        </group>
                    </group>

                     <!-- <button class="oe_highlight" type="action" icon="fa-road"
                             string="Conceptos Ejecutados En El Periodo" context="{
                       'search_default_name': active_id,
                       'default_name': active_id,
                       'search_default_numero_estimacion': active_id,
                       'default_numero_estimacion': active_id
                       }"></button> -->

                    <group  colspan="1" col="2">
                        <group string="Deducciones">
                            <field name="deducciones" >
                                <tree editable="bottom">
                                    <field name="name" readonly="1"/>
                                    <field name="porcentaje" readonly="1"/>
                                    <field name="valor"/>
                                </tree>
                            </field>
                        </group>

                        <group string="Cálculo De Estimación">
                            <group>
                                <field name="estimado"/>
                                <field name="amort_anticipo" />
                                <field name="estimacion_subtotal" readonly="1"/>
                                <field name="estimacion_iva" readonly="1"/>
                                <field name="estimacion_facturado" readonly="1"/>
                                <field name="estimado_deducciones" readonly="1"/>
                                <field name="ret_dev" readonly="1"/>
                                <field name="sancion" readonly="1"/>
                                <field name="a_pagar" readonly="1"  />
                            </group>
                        </group>

                        <group string="Penas Convencionales">
                            <field name="menos_clau_retraso" class="oe_inline"/>
                            <field name="sancion_incump_plazo" class="oe_inline"/>
                        </group>
                    </group>
                        </page>

                        <page string="Conceptos Ejecutados En El Periodo">
                            <group>
                                <field name="numero_estimacion" attrs="{'readonly': [('tipo_estimacion','!=', '2')]}"/>

                                <field name="fecha_inicio_estimacion"/>
                                <field name="conceptos_partidas" string="# Concepto de partidas" widget='one2many'>
                                    <tree editable="bottom" >
                                        <field name="categoria" />
                                        <field name="concepto" />
                                        <field name="medida" />
                                        <field name="precio_unitario" />
                                        <field name="contratada" />
                                        <field name="est_ant" />
                                        <field name="pendiente" />
                                        <field name="estimacion"/>
                                        <field name="importe_ejecutado" />
                                        <field name="obra" />
                                    </tree>
                                </field>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

      <!-- PARTIDAS ESTIMACIONES SEARCH-->
      <record model="ir.ui.view" id="partidas_estimaciones_search">
         <field name="name">elaboracion contrato</field>
         <field name="model">control.estimaciones</field>
         <field name="arch" type="xml">
            <search>
                  <field name="obra"/>
                <field name="tipo_estimacion"/>
                <field name="fecha_inicio_estimacion"/>
                <field name="fecha_termino_estimacion"/>
                <field name="estimado"/>
                <field name="amort_anticipo"/>
                <field name="estimacion_subtotal"/>
                <field name="estimacion_iva"/>
                <field name="estimacion_facturado"/>
                <field name="estimado_deducciones"/>
                <field name="ret_dev"/>
                <field name="sancion"/>
                <field name="a_pagar"/>
            </search>
         </field>
        </record>
    <!-- ESTIMACIONES TREE -->
    <record id="control_estimaciones_estimaciones_tree" model="ir.ui.view">
        <field name="name">control de estimaciones tree</field>
        <field name="model">control.estimaciones</field>
        <field name="arch" type="xml">
            <tree string="">
                <field name="obra"/>
                <field name="tipo_estimacion"/>
                <field name="fecha_inicio_estimacion"/>
                <field name="fecha_termino_estimacion"/>
                <field name="estimado"/>
                <field name="amort_anticipo"/>
                <field name="estimacion_subtotal"/>
                <field name="estimacion_iva"/>
                <field name="estimacion_facturado"/>
                <field name="estimado_deducciones"/>
                <field name="ret_dev"/>
                <field name="sancion"/>
                <field name="a_pagar"/>
            </tree>
        </field>
    </record>

 <!-- BOTON ESTIMACIONES -->
<record model="ir.actions.act_window" id="action_estimaciones">
        <field name="name">Estimaciones</field>
        <field name="res_model">control.estimaciones</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_type">form</field>
        <field name="view_ids" eval="[(5, 0, 0),
    (0, 0, {'view_mode': 'tree', 'view_id': ref('control_estimaciones_estimaciones_tree')}),
    (0, 0, {'view_mode': 'form', 'view_id': ref('control_estimaciones_estimaciones_form')})]"/>
        <field name="target">current</field>
    </record>

      <!-- VISTA TREE DE PARTIDAS -->
      <record model="ir.ui.view" id="proc_contratacion_elaboracion_contrato_3">
      <field name="name">proceso.elaboracion_contrato.tree3</field>
      <field name="model">partidas.partidas</field>
      <field name="arch" type="xml">
        <tree create="false">
            <field name="obra"/>
            <field name="programaInversion" />
            <field name="monto_partida" />
            <field name="iva_partida" />
            <field name="total_partida" />
        </tree>
      </field>
    </record>

      <!-- VISTA CON BOTONES -->
    <record id="vista_form_estimaciones" model="ir.ui.view">
        <field name="name">vista form estimaciones</field>
        <field name="model">partidas.partidas</field>
        <field name="arch" type="xml">
            <form string="" >
                <sheet>

                  <div class="oe_button_box oe_read_only" name="button_box">
                          <button name="%(action_estimaciones)d" type="action" icon="fa-usd" string="Estimaciones" context="{
                       'search_default_obra': active_id,
                       'default_obra': active_id
                       }"></button>
                      <button type="action" icon="fa-list" string="Estado de Cuenta"></button>

                </div>

                      <group colspan="1" col="3" string="Partida:">
                         <group> <field name="numero_contrato" readonly="1"/> </group>
                         <group> <field name="obra" readonly="True"/> </group>
                         <group> <field name="programaInversion" readonly="True"/> </group>
                      </group>

                      <group colspan="1" col="3">
                         <group> <field name="monto_partida" readonly="True" widget="monetary"/> </group>
                         <group> <field name="iva_partida" readonly="True" widget="monetary"/> </group>
                         <group> <field name="total_partida" readonly="True" widget="monetary"/> </group>
                      </group>

                      <!-- <group>

                        <group colspan="2" col="2">
                            <group string="Catálogo de Niveles/Conceptos del Contrato:"></group>
                            <group><field name="name" string="" class="o_light_label"/></group>
                        </group>

                        <group colspan="2" col="3">
                            <group><field name="total" /></group>
                            <group> <field name="total_contrato"/></group>
                            <group><field name="diferencia"  class="o_light_label"/></group>
                        </group>

                        <field name="conceptos_partidas" string="# Concepto de partidas" readonly="True">
                            <tree>
                                <control>
                                    <create string="Agregar Sección" context="{'default_display_type': 'line_section'}"/>
                                    <create string="Add a note" context="{'default_display_type': 'line_note'}"/>
                                    <create string="Agregar Nivel"/>
                                </control>
                                <field name="name" string="" widget="section_and_note_Text" />
                                <field name="sequence" type="handle" invisible="1"/>
                                <field name="display_type" invisible="1" />
                                <field name="categoria" />
                                <field name="concepto"/>
                                <field name="grupo"/>
                                <field name="medida"/>
                                <field name="precio_unitario" widget="monetary"/>
                                <field name="cantidad"/>
                                <field name="importe" sum="importe" widget="monetary"/>
                            </tree>
                        </field>
                    </group> -->

                    <notebook>
                        <page string="Residencia">
                            <group string="Residencia">
                                <group><field name="residente_obra"/></group>
                                <group><field name="supervision_externa"/></group>
                                <group><field name="director_obras"/></group>
                                <group><field name="puesto_director_obras"/></group>
                            </group>
                        </page>

                        <page string="Anticipos">
                            <group string="Anticipos">
                            </group>
                                <field name="anticipos" string="">
                                    <tree>
                                        <field name="obra"/>
                                        <field name="fecha_anticipo"/>
                                        <field name="porcentaje_anticipo"/>
                                        <field name="importe"/>
                                        <field name="iva"/>
                                        <field name="total_anticipo"/>
                                        <field name="numero_fianza"/>
                                        <field name="afianzadora"/>
                                        <field name="fecha_fianza"/>
                                    </tree>
                                </field>

                        </page>

                        <!-- PAGINA DE CONV. MODIFICATORIOS -->
                        <page string="Conv. Modificatorios">
                            <group string="Conv. Modificatorios" >
                            </group>
                                <field name="convenios_modificatorios" string="" widget="one2many">
                                    <tree editable="bottom">
                                        <field name="fecha_convenios"/>
                                        <field name="referencia_convenios"/>
                                        <field name="observaciones_convenios"/>
                                        <field name="tipo_convenio"/>
                                        <field name="importe_convenios"/>
                                        <field name="iva_convenios"/>
                                        <field name="total_convenios"/>
                                    </tree>
                                </field>

                        </page>

                        <!-- PAGINA DE CATALOGOS -->
                        <page string="Catálogo">
                            <group>

                        <group colspan="2" col="2">
                            <group string="Catálogo de Niveles/Conceptos del Contrato:"></group>
                            <group><field name="name" string="" class="o_light_label"/></group>
                        </group>

                        <group colspan="2" col="3">
                            <group><field name="total" /></group>
                            <group> <field name="total_contrato"/></group>
                            <group><field name="diferencia"  class="o_light_label"/></group>
                        </group>

                        <field name="conceptos_partidas" string="# Concepto de partidas" widget="section_and_note_one2many">
                            <tree>
                                <control>
                                    <create string="Agregar Sección" context="{'default_display_type': 'line_section'}"/>
                                    <create string="Add a note" context="{'default_display_type': 'line_note'}"/>
                                    <create string="Agregar Nivel"/>
                                </control>
                                <field name="name" string="" widget="section_and_note_Text" />
                                <field name="sequence" type="handle" invisible="1"/>
                                <field name="display_type" invisible="1" />
                                <field name="categoria" />
                                <field name="concepto"/>
                                <field name="grupo"/>
                                <field name="medida"/>
                                <field name="precio_unitario" widget="monetary"/>
                                <field name="cantidad"/>
                                <field name="importe" sum="importe" widget="monetary"/>
                            </tree>
                        </field>
                    </group>
                        </page>

                        <page string="Programa">
                            <group string="Programa">
                                <group colspan="1" col="2">
                                    <group><field name="fecha_inicio_programa" readonly="1"/></group>
                                    <group><field name="fecha_termino_programa" readonly="1"/></group>
                                    <group><field name="total_partida" readonly="True" widget="monetary"/></group>
                                    <group><field name="restante_programa" readonly="1"/></group>
                                </group>

                                <field name="programa_contrato" widget='one2many'>
                                    <control>
                                        <create string="Agregar Periodo"/>
                                    </control>
                                    <tree editable="bottom">
                                        <field name="fecha_inicio"/>
                                        <field name="fecha_termino"/>
                                        <field name="monto" sum="Total:"/>
                                    </tree>
                                </field>
                            </group>
                        </page>
                    </notebook>

                </sheet>
            </form>
        </field>
    </record>


<!-- ACCIONES VENTANA LICITACIONES -->
    <record model="ir.actions.act_window" id="ejecucion_obra_control_estimacion_action_window">
      <field name="name">Control de Estimaciones</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">partidas.partidas</field>
      <field name="view_mode">tree,form</field>
      <field name="view_ids" eval="[(5, 0, 0),
        (0, 0, {'view_mode': 'tree', 'view_id': ref('proc_contratacion_elaboracion_contrato_3')}),
        (0, 0, {'view_mode': 'form', 'view_id': ref('vista_form_estimaciones')})]"/>
    </record>

      <!--<field name="view_ids" eval="[(5, 0, 0),
        (0, 0, {'view_mode': 'tree', 'view_id': ref('proc_contratacion_elaboracion_contrato_3')}),
        (0, 0, {'view_mode': 'form', 'view_id': ref('vista_form_estimaciones')})]"/>
    </record>-->

    <menuitem name="Ejecución de Obra" id="ejecucion_obra.menu_root" sequence="0"/>

    <menuitem name="Control de Estimaciones" id="control_esstimacion" parent="ejecucion_obra.menu_root"
              action="ejecucion_obra_control_estimacion_action_window" sequence="1"/>
  </data>
</odoo>